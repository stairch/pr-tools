import{Q as h,m as d}from"./index-CT79Ohpc.js";const m=async e=>{if(e)return new Promise((n,t)=>{const a=new FileReader;a.onload=()=>{const o=a.result;n(o.replace(/^data:image\/[a-z]+;base64,/,""))},a.onerror=t,a.readAsDataURL(e)})},c=()=>{p().update()},s={announements:{async getAll(){return fetch("/api/announcements").then(e=>e.json())},async create(e){const t=await(await fetch("/api/announcements",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();return c(),t},async get(e){return fetch(`/api/announcements/${e}`).then(n=>n.json())},async update(e){const t=await(await fetch(`/api/announcements/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();return c(),t},async delete(e){await fetch(`/api/announcements/${e}`,{method:"DELETE"}).then(c)},async types(){return fetch("/api/announcements/types").then(e=>e.json())},schedule:{async get(e){return fetch(`/api/announcements/${e}/schedules`).then(n=>n.json())},async update(e,n){const t=await fetch(`/api/announcements/${e}/schedules`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(t.ok)return null;const a=await t.text();return console.error(a),a}},async publish(e,n,t,a,o,u){const r=await fetch(`/api/announcements/${e}/publish`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e,scope:n,server:t,type:a,persona:o,image:await m(u)})});if(r.ok)return null;const i=await r.text();return console.error(i),i},async discordServers(){return fetch("/api/announcements/discord/servers").then(e=>e.json())},async telegramChats(){return fetch("/api/announcements/telegram/chats").then(e=>e.json())},async personas(){return fetch("/api/announcements/personas").then(e=>e.json())}},db:{async students(){return fetch("/api/students").then(e=>e.json())},async updateStudents(e){const n=await fetch("/api/students",{method:"PUT",headers:{"Content-Type":"application/xml"},body:e});return n.ok?null:await n.text()},async updateModules(e){const n=await fetch("/api/modules",{method:"PUT",headers:{"Content-Type":"application/xml"},body:e});return n.ok?null:await n.text()},async getDegreeProgrammes(){return fetch("/api/degree-programmes").then(e=>e.json())},async updateDegreeProgrammes(e){await fetch("/api/degree-programmes",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}},commonSources:{_cache:new Map,personas:{_base:"/common/personas",_cacheKey:"personas",async definition(){if(s.commonSources._cache.has(this._cacheKey))return s.commonSources._cache.get(this._cacheKey);const n=await(await fetch(this._base+"/definition.json")).json();return s.commonSources._cache.set(this._cacheKey,n.items),n.items},avatarByPath(e){return this._base+"/avatars/"+e},async avatarByName(e){const n=await this.definition();return this.avatarByPath(n[e].avatar)}},announcementTypes:{_base:"/common/announcements",_cacheKey:"announcement.types",async definition(){if(s.commonSources._cache.has(this._cacheKey))return s.commonSources._cache.get(this._cacheKey);const n=await(await fetch(this._base+"/types.json")).json();return s.commonSources._cache.set(this._cacheKey,n.items),n.items},async roleByType(e){return(await this.definition())[e].role}}}},p=h("counter",()=>{const e=d([]),n=async()=>{e.value=await s.announements.getAll()},t=async()=>"/announcements/"+(await s.announements.create({title:"",message:{de:"",en:""}})).id;return n(),{announcements:e,update:n,create:t}});export{s as a,p as u};
